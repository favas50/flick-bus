<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Bus - Flick Bus</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-gray-100">
    <nav class="bg-blue-500 p-4 text-white">
        <div class="container mx-auto flex justify-between items-center">
            <a href="/" class="text-xl font-semibold">Flick Bus</a>
            <div>
                <a href="/" class="px-3 hover:text-gray-200">Home</a>
                <a href="/about" class="px-3 hover:text-gray-200">About</a>
                <a href="/next_bus" class="px-3 hover:text-gray-200">Next Bus</a>
                <a href="/find_bus" class="px-3 hover:text-gray-200">Find Bus</a>
                <a href="/explore" class="px-3 hover:text-gray-200">Explore</a>
                <a href="/admin" class="px-3 hover:text-gray-200">Admin</a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-8">
        <h1 class="text-2xl font-semibold mb-6 text-gray-800">Find Bus Timings</h1>

        <div class="mb-4">
            <label for="from" class="block text-gray-700 text-sm font-bold mb-2">From:</label>
            <input type="text" id="from" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <div class="mb-4">
            <label for="to" class="block text-gray-700 text-sm font-bold mb-2">To:</label>
            <input type="text" id="to" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <div class="mb-4">
            <label for="route" class="block text-gray-700 text-sm font-bold mb-2">Route:</label>
            <input type="text" id="route" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <div class="mb-4">
            <label for="date" class="block text-gray-700 text-sm font-bold mb-2">Date (YYYY-MM-DD):</label>
            <input type="date" id="date" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <div class="mb-4">
            <label for="time" class="block text-gray-700 text-sm font-bold mb-2">Time (HH:MM):</label>
            <input type="time" id="time" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <button onclick="fetchBusTimings()" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
            Find Buses
        </button>

        <div id="resultsArea" class="mt-6 text-gray-800">
            <p id="noResultsMessage" class="text-gray-500 italic">Enter search criteria to find bus timings.</p>
        </div>
    </div>

    <script>
        async function fetchBusTimings() {
            const fromLocation = document.getElementById('from').value;
            const toLocation = document.getElementById('to').value;
            const route = document.getElementById('route').value;
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;

            // --- Call the Backend API ---
            try {
                const response = await fetch(`https://flick-bus-backend.onrender.com/search?from=${fromLocation}&to=${toLocation}&route=${route}&date=${date}&time=${time}`);
                const data = await response.json();
                const resultsArea = document.getElementById('resultsArea');
                const noResultsMessage = document.getElementById('noResultsMessage'); // Get the no results message element

                resultsArea.innerHTML = '<h2 class="text-xl font-semibold mb-4 text-white">Bus Timings:</h2>';

                if (data && data.length > 0) {
                    data.forEach(bus => {
                        resultsArea.innerHTML += `
                            <div class="bus-timing-card">
                                <p><strong>Route:</strong> ${bus.route}</p>
                                <p><strong>Bus:</strong> ${bus.vehicle_number}</p>
                                <p><strong>Departure:</strong> ${bus.from_station} at ${bus.departure_time}</p>
                                <p><strong>Arrival:</strong> ${bus.to_station} at ${bus.arrival_time || 'N/A'}</p>
                            </div>
                        `;
                    });
                     // Hide the initial "no results" message if buses are found
                     if (noResultsMessage) {
                         noResultsMessage.style.display = 'none';
                     }
                } else {
                    resultsArea.innerHTML += '<p id="noResultsMessage" class="text-cccccc italic">No bus timings found for this route segment on the selected date and time.</p>';
                     // Show the initial "no results" message if no buses are found
                     if (noResultsMessage) {
                         noResultsMessage.style.display = 'block';
                     }
                }

            } catch (error) {
                // Handle network errors (e.g., backend server is not running)
                console.error('Error fetching bus data:', error);
                 resultsArea.innerHTML = '<h2 class="text-xl font-semibold mb-4 text-white">Bus Timings:</h2>';
                resultsArea.innerHTML += '<p class="text-red-500 italic">Could not connect to the bus data server. Please ensure the backend is running.</p>';
                 if (noResultsMessage) {
                     noResultsMessage.style.display = 'block';
                 }
            }
            // --- End Call the Backend API ---
        }
    </script>
</body>
</html>